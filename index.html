<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no, viewport-fit=cover">
    <title>AR Event Experience - Scan & Watch</title>
    
    <!-- Mobile optimizations -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <!-- Prevent viewport scaling on Android -->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- AR.js and A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            background: #000;
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Prevent white border on Android devices */
        html {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            color: white;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            width: 100vw !important;
            height: 100vh !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            outline: none !important;
        }
        
        /* AR Scene styles - Full screen mobile fix */
        a-scene {
            width: 100vw !important;
            height: 100vh !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 1 !important;
            display: block !important;
            visibility: visible !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
        }
        
        /* Mobile Safari and Android WebView specific fixes */
        a-scene canvas {
            width: 100vw !important;
            height: 100vh !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 1 !important;
            display: block !important;
            visibility: visible !important;
            object-fit: cover !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
        }
        
        /* Force full viewport on all devices - Android specific */
        a-scene, a-scene canvas {
            min-width: 100vw !important;
            min-height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
        }
        
        /* Android Chrome specific fixes */
        @media screen and (max-width: 768px) {
            a-scene, a-scene canvas {
                width: 100vw !important;
                height: 100vh !important;
                transform: translateZ(0) !important;
                -webkit-transform: translateZ(0) !important;
            }
        }
        
        /* Galaxy A52 and similar Android devices specific fixes */
        @media screen and (width: 384px) and (height: 854px),
               screen and (width: 360px) and (height: 640px),
               screen and (width: 412px) and (height: 915px) {
            html, body {
                width: 100vw !important;
                height: 100vh !important;
                overflow-x: hidden !important;
                overflow-y: hidden !important;
            }
            
            a-scene {
                width: 100vw !important;
                height: 100vh !important;
                transform: translate3d(0, 0, 0) !important;
                -webkit-transform: translate3d(0, 0, 0) !important;
            }
            
            a-scene canvas {
                width: 100vw !important;
                height: 100vh !important;
                transform: translate3d(0, 0, 0) !important;
                -webkit-transform: translate3d(0, 0, 0) !important;
                object-fit: cover !important;
                object-position: center !important;
            }
        }
        
        /* iPhone SE and iOS devices specific fixes */
        @media screen and (width: 375px) and (height: 667px),
               screen and (width: 375px) and (height: 812px),
               screen and (width: 414px) and (height: 896px),
               screen and (width: 320px) and (height: 568px),
               screen and (width: 390px) and (height: 844px),
               screen and (width: 428px) and (height: 926px) {
            html, body {
                width: 100vw !important;
                height: 100vh !important;
                overflow: hidden !important;
                margin: 0 !important;
                padding: 0 !important;
                -webkit-overflow-scrolling: touch !important;
            }
            
            a-scene {
                width: 100vw !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                transform: translate3d(0, 0, 0) !important;
                -webkit-transform: translate3d(0, 0, 0) !important;
                -webkit-backface-visibility: hidden !important;
                backface-visibility: hidden !important;
            }
            
            a-scene canvas {
                width: 100vw !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                transform: translate3d(0, 0, 0) !important;
                -webkit-transform: translate3d(0, 0, 0) !important;
                object-fit: cover !important;
                object-position: center center !important;
                -webkit-backface-visibility: hidden !important;
                backface-visibility: hidden !important;
            }
        }
        
        /* Safari iOS specific fixes */
        @supports (-webkit-touch-callout: none) {
            html, body {
                width: 100vw !important;
                height: 100vh !important;
                overflow: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                -webkit-user-select: none !important;
                -webkit-touch-callout: none !important;
            }
            
            a-scene {
                -webkit-transform: translate3d(0, 0, 0) !important;
                -webkit-backface-visibility: hidden !important;
                -webkit-perspective: 1000px !important;
            }
            
            a-scene canvas {
                -webkit-transform: translate3d(0, 0, 0) !important;
                -webkit-backface-visibility: hidden !important;
                -webkit-transform-style: preserve-3d !important;
            }
        }
        
        /* Force hardware acceleration and prevent white space */
        a-scene {
            -webkit-backface-visibility: hidden !important;
            backface-visibility: hidden !important;
            -webkit-transform: translateZ(0) !important;
            transform: translateZ(0) !important;
            will-change: transform !important;
        }
        
        /* Universal fallback - ensure no white borders on any device */
        @media screen and (max-width: 768px) and (max-height: 1024px) {
            html {
                width: 100vw !important;
                height: 100vh !important;
                overflow: hidden !important;
            }
            
            body {
                width: 100vw !important;
                height: 100vh !important;
                overflow: hidden !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
            }
            
            a-scene {
                width: 100vw !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
                transform: translate3d(0, 0, 0) !important;
                -webkit-transform: translate3d(0, 0, 0) !important;
            }
            
            a-scene canvas {
                width: 100vw !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                outline: none !important;
                transform: translate3d(0, 0, 0) !important;
                -webkit-transform: translate3d(0, 0, 0) !important;
                object-fit: cover !important;
                object-position: center center !important;
            }
        }
        
        /* Loading screen */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        #loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .loading-subtext {
            font-size: 14px;
            opacity: 0.8;
            text-align: center;
            max-width: 280px;
            line-height: 1.4;
        }
        
        /* Instructions overlay */
        #instructions {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #instructions h2 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #4CAF50;
        }
        
        #instructions p {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        
        .step-number {
            background: #4CAF50;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        /* Request permissions buttons */
        #requestCameraPermissions {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            margin-top: 10px;
            margin-bottom: 5px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s ease;
        }
        
        #requestCameraPermissions:hover {
            background: #1976D2;
        }
        
        #requestCameraPermissions:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* Request motion permissions button */
        #requestMotionPermissions {
            background: linear-gradient(135deg, #007AFF, #0056CC, #003D99) !important;
            color: #FFFFFF !important;
            padding: 15px 30px !important;
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            letter-spacing: 0.5px !important;
            cursor: pointer !important;
            width: 90% !important;
            max-width: 350px !important;
            margin: 15px auto !important;
            display: block !important;
            text-align: center !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.4), 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s ease !important;
            transform: translateY(0) !important;
        }
        
        #requestMotionPermissions:hover {
            background: linear-gradient(135deg, #0056CC, #003D99, #002B70) !important;
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.5), 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            transform: translateY(-2px) !important;
            border-color: rgba(255, 255, 255, 0.5) !important;
        }
        
        #requestMotionPermissions:active {
            background: linear-gradient(135deg, #003D99, #002B70, #001F52) !important;
            transform: translateY(0) !important;
            box-shadow: 0 2px 10px rgba(0, 122, 255, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2) !important;
        }
        
        #requestMotionPermissions:disabled {
            background: linear-gradient(135deg, #6B7280, #4B5563, #374151) !important;
            cursor: not-allowed !important;
            transform: translateY(0) !important;
            box-shadow: none !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        /* Video overlay styles */
        #videoOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 500;
            backdrop-filter: blur(5px);
        }
        
        #eventVideo {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        #closeVideo {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Debug info */
        #debugInfo {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            max-width: 250px;
            z-index: 200;
            display: block;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        #deviceSpecs {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 10px;
            color: #ccc;
        }
        
        /* Mobile specific fixes */
        @media screen and (max-width: 768px) {
            #instructions {
                top: 10px;
                left: 10px;
                right: 10px;
                padding: 15px;
            }
            
            #instructions h2 {
                font-size: 18px;
            }
            
            #instructions p {
                font-size: 13px;
            }
            
            #debugInfo {
                bottom: 10px;
                left: 10px;
                font-size: 11px;
                max-width: 150px;
            }
        }
        
        /* Prevent iOS Safari bounce */
        body {
            touch-action: none;
            -webkit-overflow-scrolling: auto;
        }
        
        /* iPhone 16 Pro specific fixes */
        @supports (padding: max(0px)) {
            body {
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* iPhone 16 Pro Dynamic Island and notch handling */
        @media screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) {
            a-scene, a-scene canvas {
                width: 100vw !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                transform: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
        }
        
        /* Ultra-aggressive full screen enforcement */
        a-scene {
            width: 100vw !important;
            height: 100vh !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 1 !important;
            display: block !important;
            visibility: visible !important;
            transform: translate3d(0, 0, 0) !important;
        }
        
        /* Ultra-aggressive canvas enforcement */
        a-scene canvas {
            width: 100vw !important;
            height: 100vh !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 1 !important;
            display: block !important;
            visibility: visible !important;
            object-fit: cover !important;
            transform: translate3d(0, 0, 0) !important;
        }
        
        /* iPhone 16 Pro specific fixes - 414x896 dimensions */
        @media screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) {
            a-scene, a-scene canvas {
                width: 100vw !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                transform: none !important;
                margin: 0 !important;
                padding: 0 !important;
                z-index: 1 !important;
                display: block !important;
                visibility: visible !important;
                box-sizing: border-box !important;
                border: none !important;
                outline: none !important;
                overflow: hidden !important;
            }
            
            body.iphone-16-pro a-scene canvas {
                object-fit: cover !important;
                object-position: center !important;
            }
            
            /* Dynamic Island and safe area compensation */
            body.iphone-16-pro {
                padding: 0 !important;
                margin: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                overflow: hidden !important;
            }
            
            /* Force full viewport - no safe area interference */
            body.iphone-16-pro a-scene,
            body.iphone-16-pro a-scene canvas {
                width: 100vw !important;
                height: 100dvh !important;
                min-width: 100vw !important;
                min-height: 100dvh !important;
                max-width: 100vw !important;
                max-height: 100dvh !important;
                left: 0 !important;
                right: 0 !important;
                top: 0 !important;
                bottom: 0 !important;
                transform: translate3d(0, 0, 0) scale(1.001, 1.001) !important;
                border-radius: 0 !important;
                clip-path: none !important;
            }
        }
        
        /* Ultra-aggressive enforcement for detected iPhone 16 Pro */
        body.iphone-16-pro a-scene,
        body.iphone-16-pro a-scene canvas {
            width: 100vw !important;
            height: 100vh !important;
            min-width: 100vw !important;
            min-height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            outline: none !important;
            transform: translate3d(0, 0, 0) !important;
        }
        
        /* Force video elements on iPhone 16 Pro */
        body.iphone-16-pro video {
            width: 100vw !important;
            height: 100vh !important;
            object-fit: cover !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
        }
        
        /* ULTRA-AGGRESSIVE IPHONE 16 PRO FINAL FIX */
        body.iphone-16-pro,
        body.iphone-16-pro * {
            margin: 0 !important;
            padding: 0 !important;
            border: 0 !important;
            outline: 0 !important;
            box-sizing: border-box !important;
        }
        
        /* Force absolute positioning with exact dimensions */
        body.iphone-16-pro a-scene,
        body.iphone-16-pro a-scene canvas,
        body.iphone-16-pro a-scene > *,
        body.iphone-16-pro canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 414px !important;
            height: 896px !important;
            min-width: 414px !important;
            min-height: 896px !important;
            max-width: 414px !important;
            max-height: 896px !important;
            transform: none !important;
            transform-origin: 0 0 !important;
            border: none !important;
            margin: 0 !important;
            padding: 0 !important;
            z-index: 1 !important;
            overflow: hidden !important;
            object-fit: cover !important;
            display: block !important;
            visibility: visible !important;
        }
        
        /* Emergency viewport lock for iPhone 16 Pro */
        @media screen and (device-width: 414px) and (device-height: 896px) {
            html, body {
                width: 414px !important;
                height: 896px !important;
                max-width: 414px !important;
                max-height: 896px !important;
                overflow: hidden !important;
            }
            
            a-scene, canvas {
                width: 414px !important;
                height: 896px !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: auto !important;
                bottom: auto !important;
                transform: none !important;
            }
        }
        
        /* ULTRA-AGGRESSIVE VIDEO PLAYER FIXES FOR IPHONE 16 PRO */
        body.iphone-16-pro #videoOverlay {
            position: fixed !important;
            top: 0px !important;
            left: 0px !important;
            width: 414px !important;
            height: 896px !important;
            min-width: 414px !important;
            min-height: 896px !important;
            max-width: 414px !important;
            max-height: 896px !important;
            right: auto !important;
            bottom: auto !important;
            transform: none !important;
            margin: 0px !important;
            padding: 0px !important;
            border: none !important;
            outline: none !important;
            box-sizing: border-box !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            background: rgba(0, 0, 0, 0.9) !important;
            justify-content: center !important;
            align-items: center !important;
            z-index: 500 !important;
            -webkit-overflow-scrolling: touch !important;
            touch-action: pan-y !important;
        }
        
        /* Only apply flex display when video overlay is actually shown */
        body.iphone-16-pro #videoOverlay[style*="display: flex"] {
            display: flex !important;
            flex-direction: column !important;
            justify-content: flex-start !important;
            align-items: center !important;
            padding: 20px 0px !important;
        }
        
        body.iphone-16-pro #eventVideo {
            position: relative !important;
            width: 370px !important;
            height: 620px !important;
            max-width: 370px !important;
            max-height: none !important;
            min-width: 370px !important;
            min-height: 620px !important;
            object-fit: contain !important;
            object-position: center !important;
            border-radius: 10px !important;
            box-sizing: border-box !important;
            transform: none !important;
            margin: 20px 0px !important;
            padding: 0px !important;
            border: none !important;
            outline: none !important;
            flex-shrink: 0 !important;
        }
        
        body.iphone-16-pro #closeVideo {
            position: absolute !important;
            top: 20px !important;
            right: 20px !important;
            width: 40px !important;
            height: 40px !important;
            transform: none !important;
            margin: 0px !important;
            padding: 0px !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 50% !important;
            background: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
            font-size: 24px !important;
            cursor: pointer !important;
            z-index: 501 !important;
            backdrop-filter: blur(10px) !important;
        }
        
        /* GALAXY A52 SPECIFIC VIDEO PLAYER FIXES */
        @media screen and (width: 412px) and (height: 915px) {
            body.galaxy-a52 #videoOverlay {
                position: fixed !important;
                top: 0px !important;
                left: 0px !important;
                width: 412px !important;
                height: 915px !important;
                min-width: 412px !important;
                min-height: 915px !important;
                max-width: 412px !important;
                max-height: 915px !important;
                right: auto !important;
                bottom: auto !important;
                transform: none !important;
                margin: 0px !important;
                padding: 0px !important;
                border: none !important;
                outline: none !important;
                box-sizing: border-box !important;
                overflow-y: auto !important;
                overflow-x: hidden !important;
                background: rgba(0, 0, 0, 0.9) !important;
                justify-content: center !important;
                align-items: center !important;
                z-index: 500 !important;
                -webkit-overflow-scrolling: touch !important;
                touch-action: pan-y !important;
            }
            
            body.galaxy-a52 #videoOverlay[style*="display: flex"] {
                display: flex !important;
                flex-direction: column !important;
                justify-content: flex-start !important;
                align-items: center !important;
                padding: 25px 0px !important;
            }
            
            body.galaxy-a52 #eventVideo {
                position: relative !important;
                width: 370px !important;
                height: 660px !important;
                max-width: 370px !important;
                max-height: none !important;
                min-width: 370px !important;
                min-height: 660px !important;
                object-fit: contain !important;
                object-position: center !important;
                border-radius: 12px !important;
                box-sizing: border-box !important;
                transform: none !important;
                margin: 25px 0px !important;
                padding: 0px !important;
                border: none !important;
                outline: none !important;
                flex-shrink: 0 !important;
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4) !important;
            }
            
            body.galaxy-a52 #closeVideo {
                position: absolute !important;
                top: 25px !important;
                right: 25px !important;
                width: 45px !important;
                height: 45px !important;
                transform: none !important;
                margin: 0px !important;
                padding: 0px !important;
                border: 2px solid rgba(255, 255, 255, 0.4) !important;
                border-radius: 50% !important;
                background: rgba(255, 255, 255, 0.25) !important;
                color: white !important;
                font-size: 26px !important;
                cursor: pointer !important;
                z-index: 501 !important;
                backdrop-filter: blur(15px) !important;
                transition: all 0.3s ease !important;
            }
            
            body.galaxy-a52 #closeVideo:hover {
                background: rgba(255, 255, 255, 0.35) !important;
                transform: scale(1.1) !important;
            }
        }

        /* GALAXY A52 SPECIFIC VIDEO PLAYER FIXES - 384x954 dimensions */
        @media screen and (width: 384px) and (height: 954px) {
            body.galaxy-a52 #videoOverlay {
                position: fixed !important;
                top: 0px !important;
                left: 0px !important;
                width: 384px !important;
                height: 954px !important;
                min-width: 384px !important;
                min-height: 954px !important;
                max-width: 384px !important;
                max-height: 954px !important;
                right: auto !important;
                bottom: auto !important;
                transform: none !important;
                margin: 0px !important;
                padding: 0px !important;
                border: none !important;
                outline: none !important;
                box-sizing: border-box !important;
                overflow-y: auto !important;
                overflow-x: hidden !important;
                background: rgba(0, 0, 0, 0.9) !important;
                justify-content: center !important;
                align-items: center !important;
                z-index: 500 !important;
                -webkit-overflow-scrolling: touch !important;
                touch-action: pan-y !important;
            }
            
            body.galaxy-a52 #videoOverlay[style*="display: flex"] {
                display: flex !important;
                flex-direction: column !important;
                justify-content: flex-start !important;
                align-items: center !important;
                padding: 20px 0px !important;
            }
            
            body.galaxy-a52 #eventVideo {
                position: relative !important;
                width: 340px !important;
                height: 720px !important;
                max-width: 340px !important;
                max-height: none !important;
                min-width: 340px !important;
                min-height: 720px !important;
                object-fit: contain !important;
                object-position: center !important;
                border-radius: 12px !important;
                box-sizing: border-box !important;
                transform: none !important;
                margin: 20px 0px !important;
                padding: 0px !important;
                border: none !important;
                outline: none !important;
                flex-shrink: 0 !important;
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4) !important;
            }
            
            body.galaxy-a52 #closeVideo {
                position: absolute !important;
                top: 20px !important;
                right: 20px !important;
                width: 40px !important;
                height: 40px !important;
                transform: none !important;
                margin: 0px !important;
                padding: 0px !important;
                border: 2px solid rgba(255, 255, 255, 0.4) !important;
                border-radius: 50% !important;
                background: rgba(255, 255, 255, 0.25) !important;
                color: white !important;
                font-size: 22px !important;
                cursor: pointer !important;
                z-index: 501 !important;
                backdrop-filter: blur(15px) !important;
                transition: all 0.3s ease !important;
            }
            
            body.galaxy-a52 #closeVideo:hover {
                background: rgba(255, 255, 255, 0.35) !important;
                transform: scale(1.1) !important;
            }
        }
        
        /* GENERAL GALAXY A52 OPTIMIZATIONS */
        @media screen and (width: 412px) and (height: 915px),
               screen and (width: 384px) and (height: 854px),
               screen and (width: 384px) and (height: 954px) {
            body.galaxy-a52 #triggeredOverlay {
                width: 320px !important;
                max-width: 85vw !important;
                padding: 25px !important;
            }
            
            body.galaxy-a52 .triggered-title {
                font-size: 26px !important;
            }
            
            body.galaxy-a52 .countdown-circle {
                width: 90px !important;
                height: 90px !important;
                border-width: 5px !important;
            }
            
            body.galaxy-a52 .countdown-number {
                font-size: 45px !important;
            }
        }
        
        /* Hide instructions button - Updated to match motion button styling */
        #hideInstructions {
            background: linear-gradient(135deg, #4CAF50, #45a049, #2E7D32) !important;
            color: #FFFFFF !important;
            padding: 15px 30px !important;
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            letter-spacing: 0.5px !important;
            cursor: pointer !important;
            width: 90% !important;
            max-width: 350px !important;
            margin: 15px auto !important;
            display: block !important;
            text-align: center !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4), 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s ease !important;
            transform: translateY(0) !important;
        }
        
        #hideInstructions:hover {
            background: linear-gradient(135deg, #45a049, #2E7D32, #1B5E20) !important;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5), 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            transform: translateY(-2px) !important;
            border-color: rgba(255, 255, 255, 0.5) !important;
        }
        
        #hideInstructions:active {
            background: linear-gradient(135deg, #2E7D32, #1B5E20, #0D4715) !important;
            transform: translateY(0) !important;
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2) !important;
        }
        
        /* Force hide any A-Frame loading overlays */
        .a-enter-vr, .a-enter-ar {
            display: none !important;
        }
        
        /* Hide any loading screens, progress bars, or white overlays */
        .a-loader-title, .a-loader {
            display: none !important;
        }
        
        /* Force remove any white backgrounds from A-Frame */
        a-scene .a-canvas, a-scene canvas, a-scene > * {
            background: transparent !important;
            background-color: transparent !important;
        }
        
        /* Hide any permission dialog overlays */
        .a-dialog, .a-modal, .a-overlay {
            display: none !important;
        }
        
        /* Ensure no white elements are shown */
        * {
            background-color: transparent !important;
        }
        
        /* But allow our specific elements to have backgrounds */
        #loading, #instructions, #videoOverlay, #debugInfo, 
        .step-number, #requestCameraPermissions, 
        #closeVideo {
            background: revert !important;
        }
        
        /* Mobile specific fixes */
        @media screen and (max-width: 768px) {
            #instructions {
                top: 10px;
                left: 10px;
                right: 10px;
                padding: 15px;
            }
            
            #instructions h2 {
                font-size: 18px;
            }
            
            #instructions p {
                font-size: 13px;
            }
            
            #debugInfo {
                bottom: 10px;
                left: 10px;
                font-size: 11px;
                max-width: 150px;
            }
        }
        
        /* Triggered animation overlay */
        #triggeredOverlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            max-width: 80vw;
            background: rgba(76, 175, 80, 0.95);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 600;
            flex-direction: column;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: triggeredPulse 0.5s ease-in-out;
        }
        
        .triggered-content {
            text-align: center;
            color: white;
        }
        
        .triggered-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            animation: triggeredBounce 0.6s ease-out;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .triggered-subtitle {
            font-size: 14px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .countdown-circle {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            position: relative;
            animation: countdownSpin 3s linear;
        }
        
        .countdown-number {
            font-size: 40px;
            font-weight: bold;
            color: white;
            animation: countdownPulse 1s ease-in-out infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .countdown-circle::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 4px solid #FFD700;
            border-radius: 50%;
            border-top: 4px solid transparent;
            animation: countdownRotate 3s linear;
        }
        
        @keyframes triggeredPulse {
            0% { 
                opacity: 0;
                transform: scale(0.8);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes triggeredBounce {
            0% {
                transform: translateY(-50px);
                opacity: 0;
            }
            60% {
                transform: translateY(10px);
                opacity: 1;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes countdownSpin {
            0% {
                transform: rotate(0deg);
                border-color: rgba(255, 255, 255, 0.3);
            }
            100% {
                transform: rotate(360deg);
                border-color: rgba(255, 215, 0, 0.8);
            }
        }
        
        @keyframes countdownRotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        @keyframes countdownPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <div class="loader"></div>
        <div class="loading-text">Loading AR Experience</div>
        <div class="loading-subtext">Please allow camera access when prompted for the best experience</div>
        
        <!-- Manual Start Button as fallback -->
        <button id="manualStart" style="
            background: linear-gradient(135deg, #4CAF50, #45a049, #2E7D32);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            display: none;
            transition: all 0.3s ease;
        ">ðŸš€ Start AR Experience</button>
    </div>
    
    <!-- Instructions Overlay -->
    <div id="instructions">
        <h2>ðŸŽ¯ How to Use</h2>
        <div class="step">
            <div class="step-number">1</div>
            <p>Camera access is automatic - just allow when prompted</p>
        </div>
        <div class="step">
            <div class="step-number">2</div>
            <p>Grant motion permissions for enhanced AR tracking (iOS)</p>
        </div>
        <div class="step">
            <div class="step-number">3</div>
            <p>Point your camera at the marker image</p>
        </div>
        <div class="step">
            <div class="step-number">4</div>
            <p>Keep the marker in view and steady</p>
        </div>
        <div class="step">
            <div class="step-number">5</div>
            <p>Video will auto-play when detected!</p>
        </div>
        
        <!-- Motion Permission Button -->
        <button id="requestMotionPermissions">ðŸ“± Grant Motion Permission (iOS)</button>
        
        <button id="hideInstructions">Got it! Start Scanning</button>
    </div>
    
    <!-- Video Overlay -->
    <div id="videoOverlay">
        <video id="eventVideo" controls playsinline muted>
            <source src="assets/videos/demo-video.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <button id="closeVideo">&times;</button>
    </div>
    
    <!-- Triggered Animation Overlay -->
    <div id="triggeredOverlay">
        <div class="triggered-content">
            <div class="triggered-title">ðŸŽ¯ TRIGGERED!</div>
            <div class="triggered-subtitle">Starting video in...</div>
            <div class="countdown-circle">
                <div class="countdown-number" id="countdownNumber">3</div>
            </div>
        </div>
    </div>
    
    <!-- Debug Info -->
    <div id="debugInfo">
        <div>Status: <span id="status">Initializing...</span></div>
        <div>Marker: <span id="markerStatus">Not detected</span></div>
        <div>Camera: <span id="cameraStatus">Starting...</span></div>
        <div id="deviceSpecs">
            <div>Device: <span id="deviceInfo">Detecting...</span></div>
            <div>Screen: <span id="screenInfo">-</span></div>
            <div>Ratio: <span id="ratioInfo">-</span></div>
            <div>Inner: <span id="innerInfo">-</span></div>
        </div>
    </div>
    
    <!-- AR Scene -->
    <a-scene
        embedded
        arjs="debugUIEnabled: false; 
              detectionMode: mono; 
              sourceType: webcam;
              trackingMethod: best;
              maxDetectionRate: 60;
              canvasWidth: 640;
              canvasHeight: 480;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
        loading-screen="enabled: false"
        id="arScene">
        
        <!-- Assets -->
        <a-assets>
            <a-asset-item id="markerPattern" src="assets/markers/pattern-marker.patt"></a-asset-item>
            <video
                id="videoAsset"
                src="assets/videos/demo-video.mp4"
                preload="metadata"
                playsinline
                muted
                crossorigin="anonymous">
            </video>
        </a-assets>
        
        <!-- Camera -->
        <a-camera 
            id="camera"
            rotation-reader>
        </a-camera>
        
        <!-- Marker -->
        <a-marker
            id="markerA"
            type="pattern"
            preset="custom"
            url="assets/markers/pattern-marker.patt"
            smooth="true"
            smoothCount="5"
            smoothTolerance="0.01"
            smoothThreshold="2"
            minConfidence="0.6"
            raycaster="objects: .clickable">
            
            <!-- 3D Content on marker (optional) -->
            <a-box 
                position="0 0.5 0" 
                material="color: #4CAF50; opacity: 0.7" 
                scale="0.5 0.5 0.5"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 3000">
            </a-box>
            
            <a-text 
                value="Marker Detected!" 
                position="0 1.5 0" 
                align="center" 
                color="#4CAF50"
                scale="2 2 2">
            </a-text>
        </a-marker>
    </a-scene>

    <script>
        // Mobile AR Event Experience JavaScript
        class AREventExperience {
            constructor() {
                this.scene = document.querySelector('#arScene');
                this.marker = document.querySelector('#markerA');
                this.video = document.querySelector('#eventVideo');
                this.videoOverlay = document.querySelector('#videoOverlay');
                this.loading = document.querySelector('#loading');
                this.instructions = document.querySelector('#instructions');
                this.debugInfo = document.querySelector('#debugInfo');
                this.triggeredOverlay = document.querySelector('#triggeredOverlay');
                this.countdownNumber = document.querySelector('#countdownNumber');
                
                this.markerDetected = false;
                this.videoPlaying = false;
                this.cameraReady = false;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.setupAREvents();
                this.detectMobile();
                
                // Re-enable automatic permission requests for proper camera access
                this.requestPermissionsAutomatically();
                
                this.handleLoading();
                
                // Ensure video overlay starts hidden
                this.videoOverlay.style.display = 'none';
                
                // Start aggressive full-screen enforcement for iPhone 16 Pro
                if (this.detectiPhone16Pro()) {
                    this.startAggressiveFullScreenEnforcement();
                }
            }
            
            setupEventListeners() {
                // Manual start button
                const manualStartButton = document.querySelector('#manualStart');
                if (manualStartButton) {
                    manualStartButton.addEventListener('click', () => {
                        console.log('ðŸš€ Manual start button clicked - forcing AR experience to start');
                        this.hideLoading();
                        this.updateStatus('Manually started');
                        this.cameraReady = true;
                        this.ensureSceneVisible();
                    });
                }
                
                // Hide loading on any user interaction after camera permission
                const hideLoadingOnInteraction = () => {
                    console.log('ðŸ‘† User interaction detected - hiding loading screen');
                    this.hideLoading();
                    this.cameraReady = true;
                };
                
                // Add multiple interaction listeners
                document.addEventListener('click', hideLoadingOnInteraction, { once: true });
                document.addEventListener('touchstart', hideLoadingOnInteraction, { once: true });
                document.addEventListener('keydown', hideLoadingOnInteraction, { once: true });
                
                // Motion permission button with error handling
                const motionButton = document.querySelector('#requestMotionPermissions');
                if (motionButton) {
                    console.log('âœ… Motion permission button found, attaching event listener');
                    motionButton.addEventListener('click', async () => {
                        console.log('ðŸ”µ Motion permission button clicked');
                        const button = document.querySelector('#requestMotionPermissions');
                        button.disabled = true;
                        button.textContent = 'ðŸ“± Requesting Motion Permission...';
                        
                        try {
                            const result = await this.requestDeviceMotionPermission();
                            console.log('âœ… Motion permission request completed:', result);
                            button.textContent = 'âœ… Motion Permission Granted';
                            button.style.background = 'linear-gradient(135deg, #4CAF50, #45a049, #2E7D32)';
                            
                            setTimeout(() => {
                                button.style.display = 'none';
                            }, 2000);
                        } catch (error) {
                            console.log('âŒ Motion permission error:', error);
                            button.disabled = false;
                            button.textContent = 'ðŸ“± Grant Motion Permission (iOS)';
                            button.style.background = 'linear-gradient(135deg, #007AFF, #0056CC, #003D99)';
                        }
                    });
                } else {
                    console.error('âŒ Motion permission button not found!');
                }
                
                // Hide instructions
                document.querySelector('#hideInstructions').addEventListener('click', () => {
                    this.instructions.style.display = 'none';
                });
                
                // Close video
                document.querySelector('#closeVideo').addEventListener('click', () => {
                    this.closeVideo();
                });
                
                // Video ended
                this.video.addEventListener('ended', () => {
                    this.closeVideo();
                });
                
                // Handle mobile orientation
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => {
                        this.handleResize();
                    }, 500);
                });
                
                // Handle page visibility (for mobile background/foreground)
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.pauseExperience();
                    } else {
                        this.resumeExperience();
                    }
                });
            }
            
            setupAREvents() {
                // Scene loaded
                this.scene.addEventListener('loaded', () => {
                    console.log('âœ… AR Scene loaded');
                    this.updateStatus('Scene ready');
                    this.ensureSceneVisible();
                });
                
                // Scene render start - this means the camera is actually working
                this.scene.addEventListener('renderstart', () => {
                    console.log('ðŸŽ¬ AR Scene render started - camera is working!');
                    this.updateStatus('Camera active');
                    this.updateCameraStatus('Active & rendering');
                    this.hideLoading();
                    this.cameraReady = true;
                });
                
                // AR.js specific camera events
                this.scene.addEventListener('arjs-video-loaded', () => {
                    console.log('ðŸ“¹ AR.js camera video loaded successfully!');
                    this.updateCameraStatus('Video stream active');
                    this.hideLoading();
                    this.cameraReady = true;
                    this.ensureSceneVisible();
                });
                
                // Camera initialization
                this.scene.addEventListener('camera-init', () => {
                    console.log('ðŸ“· AR camera initialized');
                    this.updateCameraStatus('Initialized');
                    this.hideLoading();
                    this.cameraReady = true;
                });
                
                // Listen for any AR.js source-ready events
                window.addEventListener('arjs-source-ready', () => {
                    console.log('ðŸŽ¯ AR.js camera source ready!');
                    this.updateCameraStatus('Source ready');
                    this.hideLoading();
                    this.cameraReady = true;
                });
                
                // Marker found
                this.marker.addEventListener('markerFound', () => {
                    console.log('ðŸŽ¯ Marker detected!');
                    this.markerDetected = true;
                    this.updateMarkerStatus('Detected!');
                    this.triggerVideo();
                });
                
                // Marker lost
                this.marker.addEventListener('markerLost', () => {
                    console.log('âŒ Marker lost');
                    this.markerDetected = false;
                    this.updateMarkerStatus('Not detected');
                });
                
                // Enhanced error handling
                this.scene.addEventListener('camera-error', (error) => {
                    console.error('âŒ Camera error:', error);
                    this.updateCameraStatus('Error detected');
                    this.showCameraError();
                });
                
                // Listen for any WebRTC/getUserMedia errors
                window.addEventListener('error', (event) => {
                    if (event.message && (event.message.includes('getUserMedia') || event.message.includes('camera'))) {
                        console.error('âŒ Camera-related error:', event);
                        this.updateCameraStatus('Browser error');
                        this.showCameraError();
                    }
                });
                
                // Force check camera status periodically
                this.startCameraStatusCheck();
                
                // Ensure scene becomes visible
                setTimeout(() => {
                    this.ensureSceneVisible();
                    this.checkARjsStatus();
                }, 1000);
                
                // Check again after more time
                setTimeout(() => {
                    this.ensureSceneVisible();
                    this.checkARjsStatus();
                    this.forceARjsCamera();
                }, 5000);
            }
            
            debugMarkerDetection() {
                console.log('ðŸ” Debugging marker detection...');
                
                // Check if marker element exists
                const marker = document.querySelector('#markerA');
                if (marker) {
                    console.log('âœ… Marker element found:', marker);
                    console.log('ðŸ“„ Marker URL:', marker.getAttribute('url'));
                    console.log('ðŸŽ¯ Marker type:', marker.getAttribute('type'));
                    console.log('âš™ï¸ Marker preset:', marker.getAttribute('preset'));
                } else {
                    console.error('âŒ Marker element not found!');
                }
                
                // Check if pattern file is accessible
                fetch('assets/markers/pattern-marker.patt')
                    .then(response => {
                        if (response.ok) {
                            console.log('âœ… Pattern file accessible');
                            return response.text();
                        } else {
                            console.error('âŒ Pattern file not accessible:', response.status);
                        }
                    })
                    .then(content => {
                        if (content) {
                            console.log('ðŸ“„ Pattern file content length:', content.length);
                            console.log('ðŸ“„ Pattern file first line:', content.split('\n')[0]);
                        }
                    })
                    .catch(error => {
                        console.error('âŒ Error loading pattern file:', error);
                    });
                
                // Check AR.js context
                if (this.scene && this.scene.systems && this.scene.systems['arjs']) {
                    console.log('âœ… AR.js system found');
                    const arjsSystem = this.scene.systems['arjs'];
                    console.log('ðŸ”§ AR.js system:', arjsSystem);
                } else {
                    console.error('âŒ AR.js system not found');
                }
                
                // Check camera status
                const video = document.querySelector('video');
                if (video) {
                    console.log('ðŸ“¹ Video element found');
                    console.log('ðŸ“¹ Video ready state:', video.readyState);
                    console.log('ðŸ“¹ Video dimensions:', video.videoWidth, 'x', video.videoHeight);
                } else {
                    console.error('âŒ Video element not found');
                }
            }
            
            ensureSceneVisible() {
                const scene = document.querySelector('a-scene');
                const canvas = document.querySelector('a-scene canvas');
                
                if (scene) {
                    scene.style.display = 'block';
                    scene.style.visibility = 'visible';
                    scene.style.width = '100vw';
                    scene.style.height = '100vh';
                    scene.style.position = 'fixed';
                    scene.style.top = '0';
                    scene.style.left = '0';
                    console.log('Ensuring scene is visible and full screen');
                }
                
                if (canvas) {
                    canvas.style.display = 'block';
                    canvas.style.visibility = 'visible';
                    canvas.style.width = '100vw';
                    canvas.style.height = '100vh';
                    canvas.style.position = 'fixed';
                    canvas.style.top = '0';
                    canvas.style.left = '0';
                    canvas.style.zIndex = '1';
                    console.log('Ensuring canvas is visible and full screen');
                }
                
                // Apply iPhone 16 Pro specific fixes if detected
                if (this.detectiPhone16Pro()) {
                    this.applyiPhone16ProFixes();
                }
                
                this.updateStatus('Scene visible');
                this.hideLoading(); // Hide loading when scene is visible
            }
            
            async requestCameraPermission() {
                try {
                    console.log('ðŸ“· Letting AR.js handle camera initialization...');
                    this.updateCameraStatus('Waiting for AR.js');
                    
                    // Let AR.js handle camera access entirely - don't request manually
                    // This prevents conflicts between our permission request and AR.js
                    console.log('âœ… Camera handling delegated to AR.js');
                    this.updateCameraStatus('AR.js handling camera');
                    
                    // Hide loading after a short delay to let AR.js start
                    setTimeout(() => {
                        console.log('ðŸ“· Initial camera setup complete - hiding loading');
                        this.hideLoading();
                        this.updateStatus('Camera delegated to AR.js');
                        this.cameraReady = true;
                        this.ensureSceneVisible();
                    }, 2000);
                    
                } catch (error) {
                    console.error('âŒ Camera delegation error:', error);
                    this.updateCameraStatus('Delegation error');
                    
                    // Still hide loading and let user proceed
                    setTimeout(() => {
                        this.hideLoading();
                        this.updateStatus('Camera error - proceeding anyway');
                        this.cameraReady = true;
                    }, 1000);
                }
            }
            
            async requestDeviceMotionPermission() {
                try {
                    console.log('ðŸ”„ Starting iOS device motion permission flow...');
                    console.log('ðŸ“± Device User Agent:', navigator.userAgent);
                    console.log('ðŸŒ Current URL:', window.location.href);
                    
                    // Ensure we're on iOS before proceeding
                    if (!this.detectiOS()) {
                        console.log('âš ï¸ Non-iOS device detected - skipping motion permissions');
                        return;
                    }
                    
                    // Check if device motion permission is available
                    if (typeof DeviceOrientationEvent === 'undefined') {
                        console.log('âš ï¸ DeviceOrientationEvent not available');
                        return;
                    }
                    
                    if (typeof DeviceOrientationEvent.requestPermission !== 'function') {
                        console.log('âš ï¸ DeviceOrientationEvent.requestPermission not available - likely older iOS');
                        this.enableDeviceOrientationListeners();
                        this.enableDeviceMotionListeners();
                        return;
                    }
                    
                    console.log('ðŸŽ¯ iOS 13+ detected - requesting device orientation permission...');
                    console.log('ðŸ’¡ About to show iOS permission dialog...');
                    
                    // Add a small delay before requesting to ensure clean state
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    try {
                        // Request device orientation permission with proper user context
                        const orientationPermission = await DeviceOrientationEvent.requestPermission();
                        console.log('ðŸŽ¯ Device orientation permission result:', orientationPermission);
                        
                        if (orientationPermission === 'granted') {
                            console.log('âœ… Device orientation permission granted');
                            this.enableDeviceOrientationListeners();
                        } else {
                            console.log('âŒ Device orientation permission denied');
                        }
                    } catch (orientationError) {
                        console.log('âš ï¸ Device orientation permission error:', orientationError.message);
                        console.log('ðŸ” Error name:', orientationError.name);
                        console.log('ðŸ” Error stack:', orientationError.stack);
                    }
                    
                    // Also check for device motion permission
                    if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                        console.log('ðŸš€ Requesting device motion permission...');
                        
                        // Another small delay between requests
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        try {
                            const motionPermission = await DeviceMotionEvent.requestPermission();
                            console.log('ðŸš€ Device motion permission result:', motionPermission);
                            
                            if (motionPermission === 'granted') {
                                console.log('âœ… Device motion permission granted');
                                this.enableDeviceMotionListeners();
                                return 'granted';
                            } else {
                                console.log('âŒ Device motion permission denied');
                                throw new Error('Motion permission denied');
                            }
                        } catch (motionError) {
                            console.log('âš ï¸ Device motion permission error:', motionError.message);
                            console.log('ðŸ” Error name:', motionError.name);
                            console.log('ðŸ” Error stack:', motionError.stack);
                            throw motionError;
                        }
                    } else {
                        // For older iOS or non-iOS devices, just enable listeners
                        console.log('âš ï¸ DeviceMotionEvent.requestPermission not available - enabling listeners directly');
                        this.enableDeviceMotionListeners();
                        return 'granted'; // Assume granted for older devices
                    }
                    
                    // Wait a moment to ensure permissions are processed
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    console.log('âœ… Device motion permission flow completed');
                    
                } catch (error) {
                    console.log('âŒ Device motion permission flow error:', error.message);
                    console.log('ðŸ” Error name:', error.name);
                    console.log('ðŸ” Error stack:', error.stack);
                    // Don't block the experience if motion permissions fail
                    // Still enable listeners for non-iOS devices
                    this.enableDeviceOrientationListeners();
                    this.enableDeviceMotionListeners();
                }
            }
            
            enableDeviceOrientationListeners() {
                console.log('ðŸŽ¯ Enabling device orientation listeners...');
                window.addEventListener('deviceorientation', (event) => {
                    // Handle device orientation data
                    if (this.scene && this.scene.camera) {
                        // Apply orientation data to camera or scene
                        console.log('ðŸ“± Device orientation:', {
                            alpha: event.alpha,
                            beta: event.beta,
                            gamma: event.gamma
                        });
                    }
                });
                console.log('âœ… Device orientation listeners enabled');
            }
            
            enableDeviceMotionListeners() {
                console.log('ðŸš€ Enabling device motion listeners...');
                window.addEventListener('devicemotion', (event) => {
                    // Handle device motion data
                    if (this.scene && this.scene.camera) {
                        // Apply motion data for enhanced tracking
                        console.log('ðŸ“± Device motion:', {
                            acceleration: event.acceleration,
                            rotationRate: event.rotationRate
                        });
                    }
                });
                console.log('âœ… Device motion listeners enabled');
            }
            
            triggerVideo() {
                if (this.videoPlaying) return;
                
                console.log('ðŸŽ¯ Marker triggered! Starting 3-second countdown...');
                this.videoPlaying = true;
                
                // Show triggered animation overlay
                const triggeredOverlay = document.querySelector('#triggeredOverlay');
                const countdownNumber = document.querySelector('#countdownNumber');
                
                triggeredOverlay.style.display = 'flex';
                
                // Countdown from 3 to 1
                let countdown = 3;
                countdownNumber.textContent = countdown;
                
                const countdownInterval = setInterval(() => {
                    countdown--;
                    if (countdown > 0) {
                        countdownNumber.textContent = countdown;
                        console.log(`â° Countdown: ${countdown}`);
                    } else {
                        countdownNumber.textContent = 'ðŸŽ¬';
                        console.log('ðŸŽ¬ Starting video!');
                        
                        // Clear interval and hide triggered overlay after a brief moment
                        clearInterval(countdownInterval);
                        setTimeout(() => {
                            triggeredOverlay.style.display = 'none';
                            this.showVideo();
                        }, 500);
                    }
                }, 1000);
            }
            
            showVideo() {
                console.log('ðŸ“¹ Showing video overlay');
                this.videoOverlay.style.display = 'flex';
                
                // Reset video to beginning
                this.video.currentTime = 0;
                
                // Auto-play with proper mobile handling
                const playPromise = this.video.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('âœ… Video started playing');
                    }).catch(error => {
                        console.log('âš ï¸ Auto-play prevented, user interaction required:', error);
                        // On some mobile browsers, show play button
                        this.video.controls = true;
                    });
                }
            }
            
            closeVideo() {
                this.video.pause();
                this.videoOverlay.style.display = 'none';
                
                // Also hide triggered overlay in case it's still showing
                const triggeredOverlay = document.querySelector('#triggeredOverlay');
                const countdownNumber = document.querySelector('#countdownNumber');
                triggeredOverlay.style.display = 'none';
                countdownNumber.textContent = '3'; // Reset countdown
                
                this.videoPlaying = false;
                console.log('ðŸ“´ Video closed and reset');
            }
            
            detectMobile() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const isIPhone16Pro = this.detectiPhone16Pro();
                const isGalaxyA52 = this.detectGalaxyA52();
                
                console.log('=== MOBILE DETECTION ===');
                console.log('Is mobile device:', isMobile);
                console.log('Is iPhone 16 Pro:', isIPhone16Pro);
                console.log('Is Galaxy A52:', isGalaxyA52);
                
                // Update device info display
                this.updateDeviceInfo(isIPhone16Pro, isGalaxyA52);
                
                if (isMobile || isIPhone16Pro || isGalaxyA52) {
                    document.body.classList.add('mobile');
                    console.log('âœ… Mobile class added to body');
                    
                    if (isIPhone16Pro) {
                        document.body.classList.add('iphone-16-pro');
                        console.log('ðŸŽ¯ iPhone 16 Pro detected - applying specific fixes');
                        console.log('ðŸ“± iPhone 16 Pro class added to body');
                    }
                    
                    if (isGalaxyA52) {
                        document.body.classList.add('galaxy-a52');
                        console.log('ðŸ“± Galaxy A52 detected - applying specific fixes');
                        console.log('ðŸŽ¯ Galaxy A52 class added to body');
                    }
                    
                    // Enable debug info on mobile for testing
                    this.debugInfo.style.display = 'block';
                    console.log('ðŸ“Š Debug info enabled for mobile');
                    
                    // Mobile-specific viewport fixes
                    this.fixMobileViewport();
                    console.log('ðŸ”§ Mobile viewport fixes applied');
                }
                
                console.log('=== END MOBILE DETECTION ===');
                return isMobile || isIPhone16Pro || isGalaxyA52;
            }
            
            updateDeviceInfo(isIPhone16Pro, isGalaxyA52) {
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                const pixelRatio = window.devicePixelRatio;
                const innerWidth = window.innerWidth;
                const innerHeight = window.innerHeight;
                
                // Update device info display
                let deviceName = 'Other device';
                if (isIPhone16Pro) deviceName = 'iPhone 16 Pro âœ…';
                if (isGalaxyA52) deviceName = 'Galaxy A52 ðŸ“±';
                
                document.querySelector('#deviceInfo').textContent = deviceName;
                document.querySelector('#screenInfo').textContent = `${screenWidth}x${screenHeight}`;
                document.querySelector('#ratioInfo').textContent = `${pixelRatio}x`;
                document.querySelector('#innerInfo').textContent = `${innerWidth}x${innerHeight}`;
                
                console.log('ðŸ“± Device info updated on screen');
            }
            
            detectiOS() {
                return /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                       (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
            }
            
            detectiPhone16Pro() {
                // Enhanced iPhone 16 Pro detection with comprehensive logging
                const userAgent = navigator.userAgent;
                const isIOS = /iPad|iPhone|iPod/.test(userAgent);
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                const pixelRatio = window.devicePixelRatio;
                const innerWidth = window.innerWidth;
                const innerHeight = window.innerHeight;
                
                // Log all device information for debugging
                console.log('=== iPHONE 16 PRO DETECTION DEBUG ===');
                console.log('User Agent:', userAgent);
                console.log('Is iOS:', isIOS);
                console.log('Screen dimensions:', screenWidth, 'x', screenHeight);
                console.log('Pixel ratio:', pixelRatio);
                console.log('Inner dimensions:', innerWidth, 'x', innerHeight);
                console.log('Available dimensions:', screen.availWidth, 'x', screen.availHeight);
                
                // Enhanced iPhone 16 Pro detection (multiple possible dimensions)
                const possibleiPhone16ProSpecs = [
                    // Your actual iPhone 16 Pro dimensions
                    { width: 414, height: 896, ratio: 3 },
                    { width: 896, height: 414, ratio: 3 },
                    // Standard iPhone 16 Pro
                    { width: 393, height: 852, ratio: 3 },
                    { width: 852, height: 393, ratio: 3 },
                    // Possible variations
                    { width: 390, height: 844, ratio: 3 }, // iPhone 14 Pro dimensions
                    { width: 844, height: 390, ratio: 3 },
                    // iPhone 15 Pro dimensions
                    { width: 375, height: 812, ratio: 3 },
                    { width: 812, height: 375, ratio: 3 }
                ];
                
                let isIPhone16Pro = false;
                let matchedSpec = null;
                
                if (isIOS && pixelRatio === 3) {
                    for (const spec of possibleiPhone16ProSpecs) {
                        if ((screenWidth === spec.width && screenHeight === spec.height) ||
                            (innerWidth === spec.width && innerHeight === spec.height)) {
                            isIPhone16Pro = true;
                            matchedSpec = spec;
                            break;
                        }
                    }
                }
                
                // Also check if it's iOS with modern dimensions and 3x ratio
                if (isIOS && pixelRatio === 3 && !isIPhone16Pro) {
                    // Any iOS device with 3x pixel ratio and modern aspect ratio
                    const aspectRatio = Math.max(screenWidth, screenHeight) / Math.min(screenWidth, screenHeight);
                    if (aspectRatio > 2.0 && aspectRatio < 2.5) { // Modern iPhone aspect ratios
                        isIPhone16Pro = true;
                        matchedSpec = { width: screenWidth, height: screenHeight, ratio: pixelRatio };
                        console.log('Detected as modern iPhone (likely iPhone 16 Pro) based on aspect ratio');
                    }
                }
                
                console.log('iPhone 16 Pro detected:', isIPhone16Pro);
                if (matchedSpec) {
                    console.log('Matched spec:', matchedSpec);
                }
                console.log('=== END iPHONE 16 PRO DETECTION ===');
                
                return isIPhone16Pro;
            }
            
            detectGalaxyA52() {
                // Enhanced Galaxy A52 detection with comprehensive logging
                const userAgent = navigator.userAgent;
                const isAndroid = /Android/i.test(userAgent);
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                const pixelRatio = window.devicePixelRatio;
                const innerWidth = window.innerWidth;
                const innerHeight = window.innerHeight;
                
                // Log device information for debugging
                console.log('=== GALAXY A52 DETECTION DEBUG ===');
                console.log('User Agent:', userAgent);
                console.log('Is Android:', isAndroid);
                console.log('Screen dimensions:', screenWidth, 'x', screenHeight);
                console.log('Pixel ratio:', pixelRatio);
                console.log('Inner dimensions:', innerWidth, 'x', innerHeight);
                console.log('Available dimensions:', screen.availWidth, 'x', screen.availHeight);
                
                // Galaxy A52 specifications
                const possibleGalaxyA52Specs = [
                    // Galaxy A52 primary dimensions
                    { width: 412, height: 915, ratio: 2.625 },
                    { width: 915, height: 412, ratio: 2.625 },
                    // Alternative Galaxy A52 dimensions (actual detected dimensions)
                    { width: 384, height: 954, ratio: 2.8125 },
                    { width: 954, height: 384, ratio: 2.8125 },
                    { width: 384, height: 854, ratio: 2.625 },
                    { width: 854, height: 384, ratio: 2.625 },
                    // Similar Samsung Galaxy devices
                    { width: 360, height: 640, ratio: 2 },
                    { width: 640, height: 360, ratio: 2 },
                    { width: 360, height: 780, ratio: 2.17 },
                    { width: 780, height: 360, ratio: 2.17 }
                ];
                
                let isGalaxyA52 = false;
                let matchedSpec = null;
                
                if (isAndroid) {
                    for (const spec of possibleGalaxyA52Specs) {
                        if ((screenWidth === spec.width && screenHeight === spec.height) ||
                            (innerWidth === spec.width && innerHeight === spec.height)) {
                            isGalaxyA52 = true;
                            matchedSpec = spec;
                            if (spec.width === 384 && spec.height === 954) {
                                console.log('ðŸŽ¯ Galaxy A52 detected with exact 384x954 dimensions!');
                            }
                            break;
                        }
                    }
                }
                
                // Also check for Samsung Galaxy A series specifically in user agent
                if (isAndroid && !isGalaxyA52) {
                    const isSamsung = /Samsung|SM-A/i.test(userAgent);
                    const isGalaxyA = /Galaxy.*A|SM-A/i.test(userAgent);
                    
                    if (isSamsung || isGalaxyA) {
                        // Check if dimensions match Galaxy A52 range
                        const aspectRatio = Math.max(screenWidth, screenHeight) / Math.min(screenWidth, screenHeight);
                        if (aspectRatio > 2.0 && aspectRatio < 2.7 && pixelRatio >= 2.0) {
                            isGalaxyA52 = true;
                            matchedSpec = { width: screenWidth, height: screenHeight, ratio: pixelRatio };
                            console.log('Detected as Galaxy A series device (likely A52) based on dimensions and user agent');
                        }
                    }
                }
                
                console.log('Galaxy A52 detected:', isGalaxyA52);
                if (matchedSpec) {
                    console.log('Matched spec:', matchedSpec);
                }
                console.log('=== END GALAXY A52 DETECTION ===');
                
                return isGalaxyA52;
            }
            
            fixMobileViewport() {
                // Force viewport meta tag for mobile
                const viewport = document.querySelector('meta[name=viewport]');
                if (viewport) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover');
                }
                
                // iPhone 16 Pro specific fixes
                if (this.detectiPhone16Pro()) {
                    this.applyiPhone16ProFixes();
                }
                
                // Galaxy A52 specific fixes
                if (this.detectGalaxyA52()) {
                    this.applyGalaxyA52Fixes();
                }
                
                // Prevent iOS Safari address bar issues
                const fixViewportHeight = () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                };
                
                fixViewportHeight();
                window.addEventListener('resize', fixViewportHeight);
                window.addEventListener('orientationchange', () => {
                    setTimeout(fixViewportHeight, 500);
                    if (this.detectiPhone16Pro()) {
                        setTimeout(() => this.applyiPhone16ProFixes(), 1000);
                    }
                    if (this.detectGalaxyA52()) {
                        setTimeout(() => this.applyGalaxyA52Fixes(), 1000);
                    }
                });
            }
            
            applyiPhone16ProFixes() {
                console.log('Applying iPhone 16 Pro specific fixes');
                
                // Force full screen styles
                const scene = document.querySelector('a-scene');
                const canvas = document.querySelector('a-scene canvas');
                
                if (scene) {
                    scene.style.setProperty('width', '100vw', 'important');
                    scene.style.setProperty('height', '100vh', 'important');
                    scene.style.setProperty('position', 'fixed', 'important');
                    scene.style.setProperty('top', '0', 'important');
                    scene.style.setProperty('left', '0', 'important');
                    scene.style.setProperty('right', '0', 'important');
                    scene.style.setProperty('bottom', '0', 'important');
                    scene.style.setProperty('transform', 'translate3d(0, 0, 0)', 'important');
                    scene.style.setProperty('z-index', '1', 'important');
                }
                
                if (canvas) {
                    canvas.style.setProperty('width', '100vw', 'important');
                    canvas.style.setProperty('height', '100vh', 'important');
                    canvas.style.setProperty('position', 'fixed', 'important');
                    canvas.style.setProperty('top', '0', 'important');
                    canvas.style.setProperty('left', '0', 'important');
                    canvas.style.setProperty('right', '0', 'important');
                    canvas.style.setProperty('bottom', '0', 'important');
                    canvas.style.setProperty('transform', 'translate3d(0, 0, 0)', 'important');
                    canvas.style.setProperty('object-fit', 'cover', 'important');
                    canvas.style.setProperty('z-index', '1', 'important');
                }
                
                // Force full screen on the renderer if available
                setTimeout(() => {
                    if (this.scene && this.scene.systems && this.scene.systems.renderer) {
                        const renderer = this.scene.systems.renderer.renderer;
                        renderer.setSize(window.innerWidth, window.innerHeight);
                        renderer.domElement.style.setProperty('width', '100vw', 'important');
                        renderer.domElement.style.setProperty('height', '100vh', 'important');
                    }
                }, 500);
            }
            
            applyGalaxyA52Fixes() {
                console.log('Applying Galaxy A52 specific fixes');
                
                // Force full screen styles optimized for Galaxy A52
                const scene = document.querySelector('a-scene');
                const canvas = document.querySelector('a-scene canvas');
                
                if (scene) {
                    scene.style.setProperty('width', '100vw', 'important');
                    scene.style.setProperty('height', '100vh', 'important');
                    scene.style.setProperty('position', 'fixed', 'important');
                    scene.style.setProperty('top', '0', 'important');
                    scene.style.setProperty('left', '0', 'important');
                    scene.style.setProperty('right', '0', 'important');
                    scene.style.setProperty('bottom', '0', 'important');
                    scene.style.setProperty('transform', 'translate3d(0, 0, 0)', 'important');
                    scene.style.setProperty('z-index', '1', 'important');
                }
                
                if (canvas) {
                    canvas.style.setProperty('width', '100vw', 'important');
                    canvas.style.setProperty('height', '100vh', 'important');
                    canvas.style.setProperty('position', 'fixed', 'important');
                    canvas.style.setProperty('top', '0', 'important');
                    canvas.style.setProperty('left', '0', 'important');
                    canvas.style.setProperty('right', '0', 'important');
                    canvas.style.setProperty('bottom', '0', 'important');
                    canvas.style.setProperty('transform', 'translate3d(0, 0, 0)', 'important');
                    canvas.style.setProperty('object-fit', 'cover', 'important');
                    canvas.style.setProperty('z-index', '1', 'important');
                }
                
                // Force full screen on the renderer if available with Galaxy A52 optimizations
                setTimeout(() => {
                    if (this.scene && this.scene.systems && this.scene.systems.renderer) {
                        const renderer = this.scene.systems.renderer.renderer;
                        renderer.setSize(window.innerWidth, window.innerHeight);
                        renderer.domElement.style.setProperty('width', '100vw', 'important');
                        renderer.domElement.style.setProperty('height', '100vh', 'important');
                        
                        // Apply Galaxy A52 specific renderer optimizations
                        renderer.domElement.style.setProperty('object-fit', 'cover', 'important');
                        renderer.domElement.style.setProperty('object-position', 'center', 'important');
                    }
                }, 500);
            }
            
            forceUltraFullScreen() {
                const scene = document.querySelector('a-scene');
                const canvas = document.querySelector('a-scene canvas');
                const video = document.querySelector('video');
                
                // Get the actual viewport dimensions
                const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
                
                console.log(`ðŸ”§ Forcing ultra full screen: ${vw}x${vh}`);
                
                // Force scene to full viewport with extra coverage
                if (scene) {
                    const sceneStyles = {
                        'width': `${vw}px`,
                        'height': `${vh}px`,
                        'min-width': `${vw}px`,
                        'min-height': `${vh}px`,
                        'max-width': `${vw}px`,
                        'max-height': `${vh}px`,
                        'position': 'fixed',
                        'top': '0',
                        'left': '0',
                        'right': '0',
                        'bottom': '0',
                        'z-index': '1',
                        'display': 'block',
                        'visibility': 'visible',
                        'transform': 'translate3d(0, 0, 0)',
                        'margin': '0',
                        'padding': '0',
                        'border': 'none',
                        'outline': 'none',
                        'overflow': 'hidden',
                        'box-sizing': 'border-box'
                    };
                    
                    Object.entries(sceneStyles).forEach(([prop, value]) => {
                        scene.style.setProperty(prop, value, 'important');
                    });
                }
                
                // Force canvas to full viewport with slight oversize to eliminate gaps
                if (canvas) {
                    const canvasStyles = {
                        'width': `${vw + 2}px`,
                        'height': `${vh + 2}px`,
                        'min-width': `${vw + 2}px`,
                        'min-height': `${vh + 2}px`,
                        'max-width': `${vw + 2}px`,
                        'max-height': `${vh + 2}px`,
                        'position': 'fixed',
                        'top': '-1px',
                        'left': '-1px',
                        'right': '-1px',
                        'bottom': '-1px',
                        'z-index': '1',
                        'display': 'block',
                        'visibility': 'visible',
                        'object-fit': 'cover',
                        'transform': 'translate3d(0, 0, 0)',
                        'margin': '0',
                        'padding': '0',
                        'border': 'none',
                        'outline': 'none',
                        'overflow': 'hidden',
                        'box-sizing': 'border-box'
                    };
                    
                    Object.entries(canvasStyles).forEach(([prop, value]) => {
                        canvas.style.setProperty(prop, value, 'important');
                    });
                    
                    // Also set canvas attributes directly for iPhone 16 Pro
                    if (this.detectiPhone16Pro()) {
                        canvas.setAttribute('width', vw + 2);
                        canvas.setAttribute('height', vh + 2);
                        console.log(`ðŸ“± iPhone 16 Pro canvas sized to: ${vw + 2}x${vh + 2}`);
                    }
                    
                    // Also set canvas attributes directly for Galaxy A52
                    if (this.detectGalaxyA52()) {
                        canvas.setAttribute('width', vw + 2);
                        canvas.setAttribute('height', vh + 2);
                        console.log(`ðŸ“± Galaxy A52 canvas sized to: ${vw + 2}x${vh + 2}`);
                    }
                }
                
                // Force any video elements to full screen
                if (video) {
                    video.style.setProperty('width', `${vw}px`, 'important');
                    video.style.setProperty('height', `${vh}px`, 'important');
                    video.style.setProperty('object-fit', 'cover', 'important');
                }
                
                // Force renderer resize with extra coverage
                if (this.scene && this.scene.systems && this.scene.systems.renderer) {
                    const renderer = this.scene.systems.renderer.renderer;
                    renderer.setSize(vw + 2, vh + 2, false);
                    renderer.domElement.style.setProperty('width', `${vw + 2}px`, 'important');
                    renderer.domElement.style.setProperty('height', `${vh + 2}px`, 'important');
                    renderer.domElement.style.setProperty('left', '-1px', 'important');
                    renderer.domElement.style.setProperty('top', '-1px', 'important');
                }
                
                // Log for debugging
                console.log(`âœ… Ultra full screen enforced: scene ${vw}x${vh}, canvas ${vw + 2}x${vh + 2}`);
            }
            
            async requestPermissionsAutomatically() {
                try {
                    console.log('ðŸš€ Starting simplified permission flow...');
                    
                    // Don't request camera permission manually - let AR.js handle it
                    console.log('ðŸ“· Skipping manual camera request - AR.js will handle camera');
                    
                    // Only request motion permission for iOS devices
                    if (this.detectiOS()) {
                        console.log('ðŸ“± iOS detected - requesting motion permissions...');
                        setTimeout(async () => {
                            try {
                                await this.requestDeviceMotionPermission();
                            } catch (error) {
                                console.log('âš ï¸ Motion permission failed, continuing anyway:', error.message);
                            }
                        }, 1000);
                    }
                    
                    // Hide instructions after a delay to let AR.js start
                    setTimeout(() => {
                        const instructions = document.querySelector('#instructions');
                        if (instructions && this.cameraReady) {
                            instructions.style.display = 'none';
                        }
                    }, 8000);
                    
                    console.log('âœ… Simplified permission flow completed');
                    
                } catch (error) {
                    console.log('âš ï¸ Permission flow error:', error.message);
                    // Don't block the experience if permissions fail
                }
            }
            
            handleLoading() {
                // Show manual start button after 5 seconds as fallback
                setTimeout(() => {
                    const manualStartButton = document.querySelector('#manualStart');
                    const loadingElement = document.querySelector('#loading');
                    if (manualStartButton && loadingElement && !loadingElement.classList.contains('hidden')) {
                        console.log('â° Showing manual start button as fallback');
                        manualStartButton.style.display = 'block';
                        
                        // Update loading text to be more helpful
                        const loadingText = document.querySelector('.loading-text');
                        if (loadingText) {
                            loadingText.textContent = 'Having trouble? Use the button below!';
                        }
                    }
                }, 5000);
                
                // Hide loading after scene is ready or timeout (reduced to 8 seconds for better UX)
                setTimeout(() => {
                    if (!this.cameraReady) {
                        this.hideLoading();
                        console.log('â° Loading timeout - hiding loading screen anyway');
                        this.updateStatus('Ready (timeout)');
                        this.cameraReady = true;
                    }
                }, 8000);
                
                // Additional fallback - force hide after camera permission flow
                setTimeout(() => {
                    const loadingElement = document.querySelector('#loading');
                    if (loadingElement && !loadingElement.classList.contains('hidden')) {
                        console.log('ðŸ”„ Emergency loading screen hide - ensuring user can proceed');
                        this.hideLoading();
                        this.updateStatus('Force ready');
                    }
                }, 12000);
                
                // Ultra-aggressive final fallback
                setTimeout(() => {
                    const loadingElement = document.querySelector('#loading');
                    if (loadingElement && !loadingElement.classList.contains('hidden')) {
                        console.log('ðŸ’¥ ULTRA-AGGRESSIVE loading screen removal');
                        loadingElement.style.display = 'none';
                        this.updateStatus('Force hidden');
                        this.cameraReady = true;
                    }
                }, 15000);
            }
            
            showCameraError() {
                const loadingText = document.querySelector('.loading-text');
                const loadingSubtext = document.querySelector('.loading-subtext');
                const manualStart = document.querySelector('#manualStart');
                
                if (loadingText) {
                    loadingText.textContent = 'Camera Access Issue';
                }
                if (loadingSubtext) {
                    loadingSubtext.textContent = 'Please allow camera access and click the button below to start';
                }
                if (manualStart) {
                    manualStart.style.display = 'block';
                    manualStart.textContent = 'ðŸ“· Try Camera Access';
                }
            }
            
            startCameraStatusCheck() {
                console.log('ðŸ” Starting periodic camera status check...');
                
                // Check every 3 seconds for camera activity
                this.cameraCheckInterval = setInterval(() => {
                    this.checkCameraStatus();
                }, 3000);
                
                // Stop checking after 30 seconds
                setTimeout(() => {
                    if (this.cameraCheckInterval) {
                        clearInterval(this.cameraCheckInterval);
                        console.log('â° Camera status check stopped');
                    }
                }, 30000);
            }
            
            checkCameraStatus() {
                const video = document.querySelector('video');
                const canvas = document.querySelector('a-scene canvas');
                
                if (video && video.videoWidth > 0 && video.videoHeight > 0) {
                    console.log('âœ… Camera video is active:', video.videoWidth + 'x' + video.videoHeight);
                    this.updateCameraStatus('Video active');
                    this.cameraReady = true;
                    this.hideLoading();
                    
                    if (this.cameraCheckInterval) {
                        clearInterval(this.cameraCheckInterval);
                    }
                } else if (canvas && canvas.width > 0 && canvas.height > 0) {
                    console.log('âœ… Canvas is rendering:', canvas.width + 'x' + canvas.height);
                    this.updateCameraStatus('Canvas active');
                    this.cameraReady = true;
                    this.hideLoading();
                } else {
                    console.log('â³ Still waiting for camera/video...');
                    this.updateCameraStatus('Waiting...');
                }
            }
            
            checkARjsStatus() {
                console.log('ðŸ” Checking AR.js status...');
                
                // Check if AR.js system is loaded
                if (this.scene && this.scene.systems && this.scene.systems['arjs']) {
                    console.log('âœ… AR.js system is loaded');
                    const arjsSystem = this.scene.systems['arjs'];
                    
                    if (arjsSystem.arSource) {
                        console.log('âœ… AR.js source is available');
                        this.updateCameraStatus('AR.js source ready');
                    }
                    
                    if (arjsSystem.arContext) {
                        console.log('âœ… AR.js context is available');
                        this.updateCameraStatus('AR.js context ready');
                    }
                } else {
                    console.log('â³ AR.js system not yet loaded');
                    this.updateStatus('Loading AR.js...');
                }
                
                // Check for video element
                const video = document.querySelector('video');
                if (video) {
                    console.log('ðŸ“¹ Video element found');
                    console.log('ðŸ“¹ Video ready state:', video.readyState);
                    console.log('ðŸ“¹ Video dimensions:', video.videoWidth + 'x' + video.videoHeight);
                    
                    if (video.readyState >= 2) { // HAVE_CURRENT_DATA
                        console.log('âœ… Video has data and is ready');
                        this.updateCameraStatus('Video ready');
                        this.cameraReady = true;
                        this.hideLoading();
                    }
                } else {
                    console.log('â³ No video element found yet');
                }
            }
            
            forceARjsCamera() {
                console.log('ðŸ”§ Attempting to force AR.js camera initialization...');
                
                try {
                    // Try to access AR.js internals to force camera start
                    if (this.scene && this.scene.systems && this.scene.systems['arjs']) {
                        const arjsSystem = this.scene.systems['arjs'];
                        console.log('ðŸŽ¯ Found AR.js system, attempting to initialize...');
                        
                        // Check if we can trigger AR.js initialization
                        if (arjsSystem.tick) {
                            console.log('ðŸ”„ Triggering AR.js tick...');
                            arjsSystem.tick();
                        }
                    }
                    
                    // Also try to get video permissions directly for AR.js
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        console.log('ðŸŽ¥ Checking if camera permission is available...');
                        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                            .then(stream => {
                                console.log('âœ… Camera permission confirmed - stopping test stream');
                                stream.getTracks().forEach(track => track.stop());
                                this.updateCameraStatus('Permission confirmed');
                            })
                            .catch(error => {
                                console.log('âŒ Camera permission denied:', error.message);
                                this.updateCameraStatus('Permission denied');
                                this.showCameraError();
                            });
                    }
                    
                } catch (error) {
                    console.log('âš ï¸ Force camera error:', error.message);
                    this.updateCameraStatus('Force attempt failed');
                }
            }
            
            updateStatus(status) {
                const statusElement = document.querySelector('#status');
                if (statusElement) {
                    statusElement.textContent = status;
                }
                console.log('ðŸ“Š Status:', status);
            }
            
            updateMarkerStatus(status) {
                const markerStatusElement = document.querySelector('#markerStatus');
                if (markerStatusElement) {
                    markerStatusElement.textContent = status;
                }
            }
            
            updateCameraStatus(status) {
                const cameraStatusElement = document.querySelector('#cameraStatus');
                if (cameraStatusElement) {
                    cameraStatusElement.textContent = status;
                }
                console.log('ðŸ“· Camera Status:', status);
            }
            
            hideLoading() {
                const loadingElement = document.querySelector('#loading');
                if (loadingElement && !loadingElement.classList.contains('hidden')) {
                    loadingElement.classList.add('hidden');
                    console.log('ðŸŽ­ Loading screen hidden');
                    
                    // Remove from DOM after transition
                    setTimeout(() => {
                        if (loadingElement.classList.contains('hidden')) {
                            loadingElement.style.display = 'none';
                        }
                    }, 500);
                }
            }
            
            handleResize() {
                console.log('ðŸ“± Handling resize/orientation change');
                
                // Force full screen again after orientation change
                this.ensureSceneVisible();
                
                if (this.detectiPhone16Pro()) {
                    setTimeout(() => this.applyiPhone16ProFixes(), 500);
                }
                
                if (this.detectGalaxyA52()) {
                    setTimeout(() => this.applyGalaxyA52Fixes(), 500);
                }
                
                // Update device info
                this.updateDeviceInfo(this.detectiPhone16Pro(), this.detectGalaxyA52());
            }
            
            pauseExperience() {
                console.log('â¸ï¸ Experience paused (page hidden)');
                if (this.video && !this.video.paused) {
                    this.video.pause();
                }
            }
            
            resumeExperience() {
                console.log('â–¶ï¸ Experience resumed (page visible)');
                // Don't auto-resume video - let user control it
                this.ensureSceneVisible();
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing AR Event Experience');
            window.arExperience = new AREventExperience();
        });
    </script>
</body>
</html> 